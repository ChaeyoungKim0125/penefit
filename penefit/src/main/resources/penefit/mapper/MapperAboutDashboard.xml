<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.penefit.moons.mapper.MapperAboutDashBoard">

	<select id="teacherSelectALL"
		resultType="com.penefit.moons.domain.MemberVO">
		SELECT *
		FROM member
		WHERE member_grade = 'B'
	</select>

	<select id="selectClassToday"
		resultType="com.penefit.moons.domain.ClassVO">
		SELECT *
		FROM class
		WHERE class_date LIKE CONCAT('%',#{class_date},'%')
	</select>

	<!-- 제안이 필요한 리스트 -->
	<select id="SuggestionList"
		resultType="com.penefit.moons.domain.SuggestDTO">
		SELECT *
		FROM suggest
		WHERE status = '검토'
		ORDER BY
		suggest_regdate ASC
		LIMIT 5
	</select>
	<select id="getVisits"
		resultType="com.penefit.moons.domain.VisitsDTO">
		SELECT visit, date_format(day, '%m-%d') as day
		FROM visits
		ORDER BY day DESC
		LIMIT 10
	</select>

	<select id="getClassTodayCount" resultType="_int">
		SELECT COUNT(*)
		FROM
		class
		WHERE class_date LIKE CONCAT('%',DATE(NOW()),'%')
	</select>

	<select id="getClassActiveCount" resultType="_int">
		SELECT COUNT(*)
		FROM
		class
		WHERE class_date > NOW()
	</select>

	<select id="getClassEndCount" resultType="_int">
		SELECT COUNT(*)
		FROM
		class
		WHERE NOW() > class_date
	</select>

	<select id="getClassListToday"
		resultType="com.penefit.moons.domain.ClassVO">
		SELECT *
		FROM class
		WHERE class_date LIKE
		CONCAT('%',DATE(NOW()),'%')
		ORDER BY class_date ASC
		LIMIT 5
	</select>

	<select id="getSuggestInfo"
		resultType="com.penefit.moons.domain.SuggestDTO">
		SELECT *
		FROM suggest
		WHERE suggest_num = #{suggest_num}
	</select>

	<!-- 클래스 리스트 -->
	<select id="getClassList"
		resultType="com.penefit.moons.domain.ClassVO">
		SELECT *
		FROM class
		ORDER BY class_regdate DESC
	</select>

	<!-- 클래스 리스트 시간역 -->
	<select id="getClassListASC"
		resultType="com.penefit.moons.domain.ClassVO">
		SELECT *
		FROM class
		ORDER BY class_regdate ASC
	</select>

	<select id="getClassOne"
		resultType="com.penefit.moons.domain.ClassVO">
		SELECT *
		FROM class
		WHERE class_code = #{class_code}
	</select>

	<select id="getClassListActive"
		resultType="com.penefit.moons.domain.ClassVO">
		SELECt *
		FROM class
		WHERE class_date > NOW()
		ORDER BY
		class_regdate DESC
	</select>

	<select id="getClassListEnd"
		resultType="com.penefit.moons.domain.ClassVO">
		SELECt *
		FROM class
		WHERE NOW() > class_date
		ORDER BY
		class_regdate DESC
	</select>

	<!-- 클래스 검색 -->
	<select id="searchClass"
		resultType="com.penefit.moons.domain.ClassVO">
		SELECT *
		FROM class
		WHERE class_subject LIKE
		CONCAT('%',#{class_subject},'%')
		ORDER BY class_regdate DESC
	</select>

	<!-- 제안서 리스트 -->
	<select id="getSuggestionList"
		resultType="com.penefit.moons.domain.SuggestDTO">
		SELECT *
		FROM suggest
		WHERE status = '검토'
	</select>

	<insert id="createClass">
		INSERT INTO class
		(class_code, class_subject,
		suggest_photo, class_teacher, class_date,
		class_info, class_memlit,
		class_price, city_code, class_regdate, suggest_num)
		VALUES
		(#{class_code}, #{class_subject}, #{suggest_photo}, #{class_teacher},
		#{class_date}, #{class_info}, #{class_memlit}, #{class_price},
		#{city_code}, NOW(), #{suggest_num})
	</insert>

	<select id="getTypeCnt" resultType="string">
		SELECT class_code
		FROM class
	</select>

	<update id="rejectSuggestion">
		Update suggest
		SET status = '반려', reject_reason =
		#{reject_reason}
		WHERE suggest_num = #{suggest_num}
	</update>

	<update id="updateClass">
		UPDATE class
		SET class_subject = #{class_subject},
		suggest_photo = #{suggest_photo},
		class_date = #{class_date},
		class_info = #{class_info}, class_memlit = #{class_memlit},
		class_price = #{class_price}, class_modidate = NOW()
		WHERE class_code =
		#{class_code}
	</update>

	<delete id="deleteClass">
		DELETE FROM class
		WHERE class_code = #{class_code}
	</delete>
	<select id="getSuggestList"
		resultType="com.penefit.moons.domain.SuggestDTO">
		SELECT *
		FROM suggest
		WHERE status = '검토'
		ORDER BY
		suggest_regdate ASC
		LIMIT 5
	</select>

	<select id="getSuggestCount" resultType="_int">
		SELECT Count(*)
		FROM
		suggest
		WHERE status = '검토'
	</select>

	<select id="getQnACount" resultType="_int">
		SELECT Count(*)
		FROM qna
		WHERE qna_status = '답변대기'
	</select>

	<select id="getQnAList"
		resultType="com.penefit.moons.domain.QnAVO">
		SELECT *
		FROM qna
		WHERE qna_status = '답변대기'
		ORDER BY
		qna_regdate ASC
		LIMIT 5
	</select>
	
</mapper>